jobs:
  pitest-store-feedback:
    name: Gather PITest feedback
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Checkout project
      uses: actions/checkout@v4
      with:
        fetch-depth: 2
    - continue-on-error: true
      name: Cache Maven repository
      uses: actions/cache@v4
      with:
        key: ${{ runner.os }}-mvn-pitest-${{ hashFiles('**/pom.xml') }}
        path: ~/.m2/repository
        restore-keys: ${{ runner.os }}-mvn-pitest
    - continue-on-error: true
      name: Set up JDK
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: 21
    - continue-on-error: true
      name: run pitest
      run: mvn -e -B -Dpitest -Dfeatures="+GIT(from[HEAD~1]), +gitci" test
    - continue-on-error: true
      name: aggregate files
      run: mvn -e -B -DtrailingText="Mutation testing report generated by PITest -
        https://pitest.org - if there are surviving mutants, please check the line
        comments under 'Files changed', or the full report under the 'CI / pitest'
        check below this comment." pitest-git:aggregate
    - continue-on-error: true
      name: upload results
      uses: actions/upload-artifact@v4
      with:
        name: pitest
        path: target/pit-reports-ci/
name: PITest
on:
  repository_dispatch:
    types: trigger-ga___pitest.yml
